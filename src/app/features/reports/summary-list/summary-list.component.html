<div class="header-row">
    <h2>Summary History</h2>
    <a mat-button routerLink="/reports"><mat-icon>arrow_back</mat-icon> Back to Reports</a>
</div>

<mat-card>
    <mat-card-content>
        <div class="filter-row">
            <mat-button-toggle-group [(ngModel)]="selectedPeriod" (change)="loadSummaries()">
                <mat-button-toggle value="">All</mat-button-toggle>
                <mat-button-toggle value="daily">Daily</mat-button-toggle>
                <mat-button-toggle value="weekly">Weekly</mat-button-toggle>
                <mat-button-toggle value="on_demand">On-demand</mat-button-toggle>
            </mat-button-toggle-group>
        </div>

        <table mat-table [dataSource]="summaries" class="full-width">
            <ng-container matColumnDef="period">
                <th mat-header-cell *matHeaderCellDef>Period</th>
                <td mat-cell *matCellDef="let s">{{ s.period_start }} â€” {{ s.period_end }}</td>
            </ng-container>

            <ng-container matColumnDef="period_type">
                <th mat-header-cell *matHeaderCellDef>Type</th>
                <td mat-cell *matCellDef="let s">
                    <span class="type-chip" [ngClass]="s.period_type">{{ s.period_type }}</span>
                </td>
            </ng-container>

            <ng-container matColumnDef="status">
                <th mat-header-cell *matHeaderCellDef>Status</th>
                <td mat-cell *matCellDef="let s">
                    <span class="status-badge" [ngClass]="s.status">{{ s.status }}</span>
                </td>
            </ng-container>

            <ng-container matColumnDef="method">
                <th mat-header-cell *matHeaderCellDef>Method</th>
                <td mat-cell *matCellDef="let s">
                    <span *ngIf="s.generation_method" class="method-badge" [ngClass]="s.generation_method">
                        {{ s.generation_method === 'ai' ? 'AI' : 'Fallback' }}
                    </span>
                </td>
            </ng-container>

            <ng-container matColumnDef="preview">
                <th mat-header-cell *matHeaderCellDef>Preview</th>
                <td mat-cell *matCellDef="let s" class="preview-cell">
                    {{ s.summary_text | slice:0:100 }}{{ s.summary_text.length > 100 ? '...' : '' }}
                </td>
            </ng-container>

            <ng-container matColumnDef="generated_at">
                <th mat-header-cell *matHeaderCellDef>Generated</th>
                <td mat-cell *matCellDef="let s">{{ s.generated_at | date:'short' }}</td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns;" (click)="viewSummary(row)"
                class="clickable-row"></tr>
        </table>

        <mat-paginator [length]="totalCount" [pageSize]="20" [pageIndex]="currentPage" (page)="onPage($event)"
            showFirstLastButtons>
        </mat-paginator>
    </mat-card-content>
</mat-card>