<div class="task-list-header">
    <h2>Tasks</h2>
    <a mat-raised-button color="primary" routerLink="new" *ngIf="isManager">
        <mat-icon>add</mat-icon> New Task
    </a>
</div>

<table mat-table [dataSource]="tasks" class="full-width">
    <ng-container matColumnDef="title">
        <th mat-header-cell *matHeaderCellDef>Title</th>
        <td mat-cell *matCellDef="let task">
            <a [routerLink]="[task.id]">{{ task.title }}</a>
        </td>
    </ng-container>

    <ng-container matColumnDef="status">
        <th mat-header-cell *matHeaderCellDef>Status</th>
        <td mat-cell *matCellDef="let task">
            <mat-chip [class]="'status-' + task.status">{{ task.status }}</mat-chip>
        </td>
    </ng-container>

    <ng-container matColumnDef="priority">
        <th mat-header-cell *matHeaderCellDef>Priority</th>
        <td mat-cell *matCellDef="let task">
            <mat-chip [class]="'priority-' + task.priority">{{ task.priority }}</mat-chip>
        </td>
    </ng-container>

    <ng-container matColumnDef="assignees">
        <th mat-header-cell *matHeaderCellDef>Assignees</th>
        <td mat-cell *matCellDef="let task">
            <span *ngFor="let a of task.assignees; let last = last">
                {{ a.first_name }} {{ a.last_name }}<span *ngIf="!last">, </span>
            </span>
        </td>
    </ng-container>

    <ng-container matColumnDef="client">
        <th mat-header-cell *matHeaderCellDef>Client</th>
        <td mat-cell *matCellDef="let task">{{ task.client?.name || '-' }}</td>
    </ng-container>

    <ng-container matColumnDef="deadline">
        <th mat-header-cell *matHeaderCellDef>Deadline</th>
        <td mat-cell *matCellDef="let task">{{ task.deadline | date:'mediumDate' }}</td>
    </ng-container>

    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
    <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
</table>

<mat-paginator [length]="totalCount" [pageSize]="pageSize" [pageIndex]="currentPage - 1" (page)="onPageChange($event)">
</mat-paginator>