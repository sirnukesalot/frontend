<div class="archive-list">
    <div class="archive-header">
        <h2>Archive</h2>
    </div>

    <app-search-bar placeholder="Search archived tasks..." (search)="onSearch($event)"></app-search-bar>

    <table mat-table [dataSource]="tasks" class="full-width">
        <ng-container matColumnDef="title">
            <th mat-header-cell *matHeaderCellDef>Title</th>
            <td mat-cell *matCellDef="let task">
                <a [routerLink]="['/tasks', task.id]">{{ task.title }}</a>
            </td>
        </ng-container>

        <ng-container matColumnDef="priority">
            <th mat-header-cell *matHeaderCellDef>Priority</th>
            <td mat-cell *matCellDef="let task">
                <mat-chip [class]="'priority-' + task.priority">{{ task.priority }}</mat-chip>
            </td>
        </ng-container>

        <ng-container matColumnDef="assignees">
            <th mat-header-cell *matHeaderCellDef>Assignees</th>
            <td mat-cell *matCellDef="let task">
                <span *ngFor="let a of task.assignees; let last = last">
                    {{ a.first_name }} {{ a.last_name }}<span *ngIf="!last">, </span>
                </span>
            </td>
        </ng-container>

        <ng-container matColumnDef="client">
            <th mat-header-cell *matHeaderCellDef>Client</th>
            <td mat-cell *matCellDef="let task">{{ task.client?.name || '-' }}</td>
        </ng-container>

        <ng-container matColumnDef="tags">
            <th mat-header-cell *matHeaderCellDef>Tags</th>
            <td mat-cell *matCellDef="let task">
                <mat-chip-set>
                    <mat-chip *ngFor="let t of task.tags" [style.background-color]="t.color"
                        [style.color]="isLightColor(t.color) ? '#000' : '#fff'" class="tag-chip">
                        {{ t.name }}
                    </mat-chip>
                </mat-chip-set>
            </td>
        </ng-container>

        <ng-container matColumnDef="deadline">
            <th mat-header-cell *matHeaderCellDef>Deadline</th>
            <td mat-cell *matCellDef="let task">{{ task.deadline | date:'mediumDate' }}</td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
    </table>

    <mat-paginator [length]="totalCount" [pageSize]="pageSize" [pageIndex]="currentPage - 1"
        (page)="onPageChange($event)">
    </mat-paginator>
</div>